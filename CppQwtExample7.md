
 

 

 

 

 

([C++](Cpp.md)) [QwtExample7](CppQwtExample7.md)
==================================================

 

![Qt](PicQt.png)![Qwt](PicQwt.png)![Qt
Creator](PicQtCreator.png)![Lubuntu](PicLubuntu.png)![Windows](PicWindows.png)

 

[Qwt example 7: spectrogram from Qwt examples](CppQwtExample7.md) is a
[Qwt](CppQwt.md) [example](CppExample.md) of a spectrogram from the
Qwt documentation

 

-   [View a screenshot of CppQwtExample7 (png)](CppQwtExample7.png)
-   [Download the Qt Creator project
    'CppQwtExample7' (zip)](CppQwtExample7.zip)

Technical facts
---------------

 

[Operating system(s) or programming environment(s)](CppOs.md)

-   ![Lubuntu](PicLubuntu.png) [Lubuntu](CppLubuntu.md) 15.04 (vivid)

[IDE(s)](CppIde.md):

-   ![Qt Creator](PicQtCreator.png) [Qt Creator](CppQtCreator.md) 3.1.1

[Project type](CppQtProjectType.md):

-   ![console](PicConsole.png) [Console
    application](CppConsoleApplication.md)

[C++ standard](CppStandard.md):

-   ![C++98](PicCpp98.png) [C++98](Cpp98.md)

[Compiler(s)](CppCompiler.md):

-   [G++](CppGpp.md) 4.9.2

[Libraries](CppLibrary.md) used:

-   ![STL](PicStl.png) [STL](CppStl.md): GNU ISO C++ Library, version
    4.9.2

 

 

 

 

 

[Qt project file](CppQtProjectFile.md): ./CppQwtExample7/CppQwtExample7.pro
----------------------------------------------------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #Qwt does not go together with Qwt include(../../DesktopApplicationNoWeffcpp.pri) include(../../Libraries/Qwt.pri)   SOURCES += main.cpp \     plot.cpp  HEADERS += \     plot.h`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQwtExample7/main.cpp
-------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #pragma GCC diagnostic push #pragma GCC diagnostic ignored "-Weffc++" #pragma GCC diagnostic ignored "-Wunused-local-typedefs" #pragma GCC diagnostic ignored "-Wunused-but-set-parameter" #include <qapplication.h> #include <qmainwindow.h> #include <qtoolbar.h> #include <qtoolbutton.h> #include <qslider.h> #include "plot.h" #pragma GCC diagnostic pop  class MainWindow: public QMainWindow { public:     MainWindow(QWidget * parent = nullptr);     MainWindow(const MainWindow&) = delete;     MainWindow& operator=(const MainWindow&) = delete;  private:     Plot *d_plot; };  MainWindow::MainWindow(QWidget *parent)   : QMainWindow(parent),     d_plot(new Plot(this)) {       setCentralWidget( d_plot );      QToolBar *toolBar = new QToolBar( this );      QToolButton *btnSpectrogram = new QToolButton( toolBar );     btnSpectrogram->setText( "Spectrogram" );     btnSpectrogram->setCheckable( true );     btnSpectrogram->setToolButtonStyle( Qt::ToolButtonTextUnderIcon );     toolBar->addWidget( btnSpectrogram );     connect( btnSpectrogram, SIGNAL( toggled( bool ) ),         d_plot, SLOT( showSpectrogram( bool ) ) );      QToolButton *btnContour = new QToolButton( toolBar );     btnContour->setText( "Contour" );     btnContour->setCheckable( true );     btnContour->setToolButtonStyle( Qt::ToolButtonTextUnderIcon );     toolBar->addWidget( btnContour );     connect( btnContour, SIGNAL( toggled( bool ) ),         d_plot, SLOT( showContour( bool ) ) );  #ifndef QT_NO_PRINTER     QToolButton *btnPrint = new QToolButton( toolBar );     btnPrint->setText( "Print" );     btnPrint->setToolButtonStyle( Qt::ToolButtonTextUnderIcon );     toolBar->addWidget( btnPrint );     connect( btnPrint, SIGNAL( clicked() ),         d_plot, SLOT( printPlot() ) ); #endif      QSlider *slider = new QSlider( Qt::Horizontal );     slider->setRange( 0, 255 );     slider->setValue( 255 );     connect( slider, SIGNAL( valueChanged( int ) ),         d_plot, SLOT( setAlpha( int ) ) );      toolBar->addWidget( slider );      addToolBar( toolBar );      btnSpectrogram->setChecked( true );     btnContour->setChecked( false );  }  int main( int argc, char **argv ) {     QApplication a( argc, argv );      MainWindow mainWindow;     mainWindow.resize( 600, 400 );     mainWindow.show();      return a.exec(); }  /* #pragma GCC diagnostic push #pragma GCC diagnostic ignored "-Weffc++" #pragma GCC diagnostic ignored "-Wunused-local-typedefs" #pragma GCC diagnostic ignored "-Wunused-but-set-parameter" #include <boost/math/constants/constants.hpp> #include <boost/shared_ptr.hpp> #include <boost/make_shared.hpp>  #include <QApplication>  #include "qwt_plot.h" #include "qwt_plot_curve.h" #include "qwt_text.h" #include "qwt_plot_spectrogram.h" #include "qwt_matrix_raster_data.h"  #ifdef _WIN32 #include "qwt_point_data.h" #endif #pragma GCC diagnostic pop  int main(int argc, char *argv[]) {   QApplication a(argc, argv);    const auto curve = boost::make_shared<QwtPlotCurve>("Sine");   const boost::shared_ptr<QwtPlotSpectrogram> plot = boost::make_shared<QwtPlotSpectrogram>();   const double tau = boost::math::constants::two_pi<double>();     QwtMatrixRasterData * const data = new QwtMatrixRasterData;    const int n_rows = 10;   for (int row = 0; row != n_rows; ++row)   {     const int n_cols = 10;     for (int col = 0; col != n_cols; ++col)     {       const double x = tau * static_cast<double>(col) / static_cast<double>(n_cols);       const double y = tau * static_cast<double>(row) / static_cast<double>(n_rows);       const double z = std::sin(x) * cos(y);       data->setValue(row,col,z);     }   }   plot->setData(data);   plot->setDisplayMode(QwtPlotSpectrogram::ImageMode);   //plot->renderContourLines(QRectF(0.0,0.0,10.0,10.0),QSize(10,10));   plot->show();   return a.exec(); }   */`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQwtExample7/plot.h
-----------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include <qwt_plot.h> #include <qwt_plot_spectrogram.h>  class Plot: public QwtPlot {     Q_OBJECT  public:     Plot( QWidget * = NULL );  public Q_SLOTS:     void showContour( bool on );     void showSpectrogram( bool on );     void setAlpha( int );  #ifndef QT_NO_PRINTER     void printPlot(); #endif  private:     QwtPlotSpectrogram *d_spectrogram; };`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQwtExample7/plot.cpp
-------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include <qprinter.h> #include <qprintdialog.h> #include <qwt_color_map.h> #include <qwt_plot_spectrogram.h> #include <qwt_scale_widget.h> #include <qwt_scale_draw.h> #include <qwt_plot_zoomer.h> #include <qwt_plot_panner.h> #include <qwt_plot_layout.h> #include <qwt_plot_renderer.h> #include "plot.h"  #include <qwt_plot_canvas.h> //Linux  class MyZoomer: public QwtPlotZoomer { public:     MyZoomer( QWidget *canvas ):         QwtPlotZoomer(dynamic_cast<QwtPlotCanvas *>(canvas))     {         setTrackerMode( AlwaysOn );     }      virtual QwtText trackerTextF( const QPointF &pos ) const     {         QColor bg( Qt::white );         bg.setAlpha( 200 );          QwtText text = QwtPlotZoomer::trackerTextF( pos );         text.setBackgroundBrush( QBrush( bg ) );         return text;     } };  class SpectrogramData: public QwtRasterData { public:     SpectrogramData()     {         setInterval( Qt::XAxis, QwtInterval( -1.5, 1.5 ) );         setInterval( Qt::YAxis, QwtInterval( -1.5, 1.5 ) );         setInterval( Qt::ZAxis, QwtInterval( 0.0, 10.0 ) );     }      virtual double value( double x, double y ) const     {         const double c = 0.842;          const double v1 = x * x + ( y - c ) * ( y + c );         const double v2 = x * ( y + c ) + x * ( y + c );          return 1.0 / ( v1 * v1 + v2 * v2 );     } };  class ColorMap: public QwtLinearColorMap { public:     ColorMap():         QwtLinearColorMap( Qt::darkCyan, Qt::red )     {         addColorStop( 0.1, Qt::cyan );         addColorStop( 0.6, Qt::green );         addColorStop( 0.95, Qt::yellow );     } };  Plot::Plot( QWidget *parent ):     QwtPlot( parent ) {     d_spectrogram = new QwtPlotSpectrogram();     d_spectrogram->setRenderThreadCount( 0 ); // use system specific thread count      d_spectrogram->setColorMap( new ColorMap() );     d_spectrogram->setCachePolicy( QwtPlotRasterItem::PaintCache );      d_spectrogram->setData( new SpectrogramData() );     d_spectrogram->attach( this );      QList<double> contourLevels;     for ( double level = 0.5; level < 10.0; level += 1.0 )         contourLevels += level;     d_spectrogram->setContourLevels( contourLevels );      const QwtInterval zInterval = d_spectrogram->data()->interval( Qt::ZAxis );     // A color bar on the right axis     QwtScaleWidget *rightAxis = axisWidget( QwtPlot::yRight );     rightAxis->setTitle( "Intensity" );     rightAxis->setColorBarEnabled( true );     rightAxis->setColorMap( zInterval, new ColorMap() );      setAxisScale( QwtPlot::yRight, zInterval.minValue(), zInterval.maxValue() );     enableAxis( QwtPlot::yRight );      plotLayout()->setAlignCanvasToScales( true );     replot();      // LeftButton for the zooming     // MidButton for the panning     // RightButton: zoom out by 1     // Ctrl+RighButton: zoom out to full size      QwtPlotZoomer* zoomer = new MyZoomer( canvas() );     zoomer->setMousePattern( QwtEventPattern::MouseSelect2,         Qt::RightButton, Qt::ControlModifier );     zoomer->setMousePattern( QwtEventPattern::MouseSelect3,         Qt::RightButton );      QwtPlotPanner *panner = new QwtPlotPanner( canvas() );     panner->setAxisEnabled( QwtPlot::yRight, false );     panner->setMouseButton( Qt::MidButton );      // Avoid jumping when labels with more/less digits     // appear/disappear when scrolling vertically      const QFontMetrics fm( axisWidget( QwtPlot::yLeft )->font() );     QwtScaleDraw *sd = axisScaleDraw( QwtPlot::yLeft );     sd->setMinimumExtent( fm.width( "100.00" ) );      const QColor c( Qt::darkBlue );     zoomer->setRubberBandPen( c );     zoomer->setTrackerPen( c ); }  void Plot::showContour( bool on ) {     d_spectrogram->setDisplayMode( QwtPlotSpectrogram::ContourMode, on );     replot(); }  void Plot::showSpectrogram( bool on ) {     d_spectrogram->setDisplayMode( QwtPlotSpectrogram::ImageMode, on );     d_spectrogram->setDefaultContourPen(         on ? QPen( Qt::black, 0 ) : QPen( Qt::NoPen ) );      replot(); }  void Plot::setAlpha( int alpha ) {     d_spectrogram->setAlpha( alpha );     replot(); }  #ifndef QT_NO_PRINTER  void Plot::printPlot() {     QPrinter printer( QPrinter::HighResolution );     printer.setOrientation( QPrinter::Landscape );     printer.setOutputFileName( "spectrogram.pdf" );      QPrintDialog dialog( &printer );     if ( dialog.exec() )     {         QwtPlotRenderer renderer;          if ( printer.colorMode() == QPrinter::GrayScale )         {             renderer.setDiscardFlag( QwtPlotRenderer::DiscardBackground );             renderer.setDiscardFlag( QwtPlotRenderer::DiscardCanvasBackground );             #ifdef WIN32_             renderer.setDiscardFlag( QwtPlotRenderer::DiscardCanvasFrame );             #endif //WIN32_             renderer.setLayoutFlag( QwtPlotRenderer::FrameWithScales );         }          renderer.renderTo( this, printer );     } }  #endif`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

 

